enchant();

window.onload = function() {
	/* ゲーム全体の初期設定等 */
	var game = new Game(320, 356);
	game.fps = 15;
	game.preload('map1.gif', 'chara0.gif', 'logo.png');
	game.onload = function() {
		/* ゲームスタート画面 */
		var startScene = new Scene();
		
		// タイトルロゴ
		var logo = new Sprite(848, 136);
		logo.image = game.assets['logo.png'];
		logo.scaleX = 0.3;
		logo.scaleY = 0.3;
		logo.x = -270;
		logo.y = 20;
		
		// スタートメニュー
		var startLabel1 = new Label("　 はじめから");
		startLabel1.x = 110;
		startLabel1.y = 190;
		startLabel1.color = 'gray';
		startLabel1.opacity = 0.7;
		var startLabel2 = new Label("▶ つづきから");
		startLabel2.x = 110;
		startLabel2.y = 220;
		startLabel2.width = 80;

		startLabel2.addEventListener("touchstart", function() {
			startLabel2.backgroundColor = 'black';
			startLabel2.color = 'white';
		});
		
		startLabel2.addEventListener("touchend", function(){
			game.pushScene(mainScene);
		});
		
		startScene.addChild(logo);
		startScene.addChild(startLabel1);
		startScene.addChild(startLabel2);
		game.pushScene(startScene);
		
		/* ゲーム画面 */
		var mainScene = new Scene();
		
		// マップの準備
		var map = new Map(16, 16);
		map.image = game.assets['map1.gif'];
		map.loadData([
		              [322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 342, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322,  24,  25,  26, 322, 322, 322, 322, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322,  64,  68,  66, 322, 322, 322, 322, 322, 322, 322,  24,  26, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322, 322,  43, 322, 322, 322, 322, 322, 322,  20,   1,  47,  46, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322, 322,  43, 322, 322, 322, 322, 322, 322,  43, 322,  64,  66, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322, 322,  40,   1,   1,   1,   1,   1,   1,  62, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322, 322,  43, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [  1,   1,   1,   1,   1,  62, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 342, 342, 342, 342, 342, 342, 342, 322, 322],
		              [322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 322, 322, 184, 185, 185, 185, 185, 185, 185, 185, 185, 185, 185, 185, 185, 185, 186, 322, 322, 322, 322, 322],
		              [322, 322, 322, 322, 322, 204, 205, 166, 225, 225, 167, 205, 205, 205, 205, 205, 205, 205, 205, 206, 322, 322, 322, 322, 322],
		              [322, 322,  24,  26, 322, 204, 205, 206, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 164, 186, 322, 322, 322, 322],
		              [322, 322,  44,  49,   1, 204, 205, 206, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 205, 206, 322, 322, 322, 322],
		              [322, 322,  64,  66, 322, 204, 205, 164, 185, 185, 165, 205, 205, 205, 166, 225, 225, 225, 225, 225, 226, 322, 322, 322, 322],
		              [322, 322, 322, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 206, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 206, 322, 322, 322, 322, 322, 322, 322, 322, 322, 322],
		              [322, 322, 322, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 164, 185, 185, 185, 185, 185, 185, 185, 185, 185, 185],
		              [322, 322, 322, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205],
		              [ 82, 322, 322, 322, 322, 204, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205],
		              [102, 322,  80,  81,  82, 204, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205],
		              [101,  81, 101, 101, 102, 204, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205, 205]
		              ],[
		                 [  -1,  -1,  -1,  -1, 461, 462,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1, 481, 482, 421, 421, 421,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1, 421, 421, 321, 341, 341, 341, 341, 341, 341, 321,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1, 321, 422,  -1,  -1,  -1, 400, 400, 321,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 461, 462, 461, 462,  -1,  -1,  -1],
		                 [  -1,  -1,  -1, 321,  -1,  -1,  -1,  -1,  -1, 400, 321,  -1,  -1,  -1,  -1,  -1, 421,  -1, 481, 482, 481, 482,  -1,  -1,  -1],
		                 [  -1, 461, 462, 321, 521, 521, 521, 521, 521, 521, 321, 421,  -1,  -1,  -1,  -1, 321, 341, 341, 341, 341, 341, 321,  -1,  -1],
		                 [  -1, 481, 482, 321,  -1,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1,  -1,  -1,  -1, 321, 420, 420,  -1,  -1,  -1, 321,  -1,  -1],
		                 [  -1,  -1,  -1, 321,  -1,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1],
		                 [  -1,  -1,  -1, 341,  -1,  -1, 341, 341, 341, 341, 341,  -1,  -1,  -1,  -1,  -1, 321, 521, 521, 521,  -1, 521, 321,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 341,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 421,  -1,  -1,  -1,  -1, 321, 341, 341,  -1,  -1,  -1, 321, 520,  -1],
		                 [  -1, 460,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 421,  -1,  -1, 321,  -1,  -1,  -1,  -1,  -1, 321, 520,  -1],
		                 [  -1, 480,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1,  -1,  -1, 400, 321, 520,  -1],
		                 [ 401,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 321,  -1,  -1,  -1, 400, 400, 321, 520,  -1],
		                 [  -1,  -1,  -1,  -1, 421, 421, 421,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 341, 341, 341, 341, 341, 341, 341, 520,  -1],
		                 [  -1,  -1,  -1,  -1,  -1, 421, 421,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 520, 520,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 421, 421,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1, 521, 521, 521,  -1, 421,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 400,  -1, 421, 421, 421,  -1,  -1,  -1,  -1,  -1],
		                 [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 421,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [ 520, 520, 520,  -1, 520,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [ -1,  520,  -1,  520,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [ -1,  -1, 520,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [ -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 [ -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                 ]);
		map.collisionData = [
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  1,  0,  0,  0,  0,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  1,  0,  1,  0,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  0,  1,  1,  1,  1,  0,  0,  0],
		                     [  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  0,  0],
		                     [  0,  1,  1,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  1,  1,  0,  0,  0,  1,  0,  0],
		                     [  0,  0,  0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0],
		                     [  0,  0,  0,  1,  0,  0,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  0,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  1,  0,  0,  0,  1,  1,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  0,  1,  1,  0],
		                     [  0,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  0,  1,  1,  1,  0],
		                     [  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  0,  0,  0,  1,  1,  1,  1,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0],
		                     [  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  0,  1,  1,  1,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
		                     [  0,  0,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
		                     [  1,  1,  1,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1],
		                     [  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1],
		                     [  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1],
		                     [  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1],
		                     [  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1]
		                     ];
		var foregroundMap = new Map(16, 16);
		foregroundMap.image = game.assets['map1.gif'];
		foregroundMap.loadData([
		                        [  -1,  -1,  -1,  -1, 461, 462,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 461, 462, 461, 462,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1, 461, 462,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1, 460,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        [  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1],
		                        ]);
		
		// プレイヤーの準備
		var player = new Sprite(32, 32);
		player.x = 6 * 16 - 8;
		player.y = 10 * 16;
		var image = new Surface(96, 128);
		image.draw(game.assets['chara0.gif'], 0, 0, 96, 128, 0, 0, 96, 128);
		player.image = image;
		
		// プレイヤー操作処理
		player.isMoving = false;
		player.direction = 0;
		player.walk = 1;
		player.addEventListener('enterframe', function() {
			this.frame = this.direction * 3 + this.walk;
			if (this.isMoving) {
				this.moveBy(this.vx, this.vy);

				if (!(game.frame % 3)) {
					this.walk++;
					this.walk %= 3;
				}
				if ((this.vx && (this.x-8) % 16 == 0) || (this.vy && this.y % 16 == 0)) {
					this.isMoving = false;
					this.walk = 1;
				}
			} else {
				this.vx = this.vy = 0;
				if (game.input.left) {
					this.direction = 1;
					this.vx = -4;
				} else if (game.input.right) {
					this.direction = 2;
					this.vx = 4;
				} else if (game.input.up) {
					this.direction = 3;
					this.vy = -4;
				} else if (game.input.down) {
					this.direction = 0;
					this.vy = 4;
				}
				if (this.vx || this.vy) {
					var x = this.x + (this.vx ? this.vx / Math.abs(this.vx) * 16 : 0) + 16;
					var y = this.y + (this.vy ? this.vy / Math.abs(this.vy) * 16 : 0) + 16;
					if (0 <= x && x < map.width && 0 <= y && y < map.height && !map.hitTest(x, y)) {
						this.isMoving = true;
						arguments.callee.call(this);
					}
				}
			}
		});
		
		// マップ，人をゲーム画面に追加
		var stage = new Group();
		stage.addChild(map);
		stage.addChild(player);
		stage.addChild(foregroundMap);
		mainScene.addChild(stage);
		
		
		// 操作パネルの準備		
		var pad = new Pad();
		pad.x = 20;
		pad.y = 245;
		pad.scaleX = 0.8;
		pad.scaleY = 0.8;
		
		var button = new Button("しらべる/はなす");
		button.color = 'white';
		button.x = 160;
		button.y = 300;
		
		button.addEventListener("touchstart", function(){
			var e = new enchant.Event("enter");
			this.dispatchEvent(e);
		});
		
		button.onenter = function() {
			
		};
		mainScene.addEventListener(button);
		
		// 操作パネルをゲーム画面に追加
		var control = new Group();
		control.addChild(pad);
		control.addChild(button);
		mainScene.addChild(control);
		
		// 移動時のウィンドウ制御等
		mainScene.addEventListener('enterframe', function(e) {
			var x = Math.min((game.width  - 16) / 2 - player.x, 0);
			var y = Math.min((game.height - 16) / 2 - player.y, 0);
			x = Math.max(game.width,  x + map.width)  - map.width;
			y = Math.max(game.height, y + map.height) - map.height;
			stage.x = x;
			stage.y = y;
		});
//		game.pushScene(mainScene);
	};
	game.start();
};